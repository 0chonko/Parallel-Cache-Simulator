#!/bin/bash

# Define the path to the tracefile directory
tracefile_dir="~/Documents/uni_Parallel_Syste_Architectures/SystemC_multithreaded_cache_simulation/tracefiles"

# Define the path to the experiments directory
experiments_dir="~/Documents/uni_Parallel_Syste_Architectures/SystemC_multithreaded_cache_simulation/experiments"

# Loop through each file in the tracefile directory
for file in "$tracefile_dir"/*; do
    # Get the filename without the directory path and extension
    filename=$(basename "$file")
    filename="${filename%.*}"

    # Loop through each assignment_1_tlm_x.bin where x = 1, 2, 4, 8, ..., 256
    for ((i=1; i<=256; i*=2)); do
        # Create the experimentsx directory if it doesn't exist
        experimentsx_dir="$experiments_dir/experiments$i"
        mkdir -p "$experimentsx_dir"

        # Execute assignment_1_tlm_x.bin for the current file and pipe the output to tail -20
        output=$(./assignment_1_tlm_$i.bin "$file" | tail -20)

        # Create the corresponding txt file in the experimentsx directory
        txt_file="$experimentsx_dir/$filename.txt"

        # Write the output to the txt file
        echo "$output" > "$txt_file"
    done
done
